# LogerAPI

FastAPI-сервис для логирования информации о файлах и сохранения логов на Google Диск. Веб-интерфейс отображает статистику поступления файлов в реальном времени.

## Возможности
- Приём POST-запросов с данными о файле (без самого файла)
- Сохранение логов в Google Drive, разложенных по папкам по дате
- Веб-интерфейс с двумя графиками (по минутам и по дням), фильтрами, просмотром логов
- Современный тёмный UI (HTML/CSS/JS, Chart.js)
- Автообновление статистики
- Автозапуск сервиса при перезагрузке сервера (systemd)

## Структура проекта
```
LogerAPI/
├── app/
│   ├── api.py           # FastAPI endpoints
│   ├── constants.py     # Константы
│   ├── gdrive_logger.py # Работа с Google Drive
│   └── static/          # index.html, style.css, script.js
├── main.py              # Точка входа FastAPI
├── requirements.txt     # Зависимости
├── setup_logger_api.sh  # Скрипт для автозапуска и открытия порта
├── remove_logger_api_autostart.sh # Скрипт для удаления автозапуска
```

## Быстрый старт (Ubuntu)
1. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```
2. **Создайте сервисный ключ Google API** и положите `credentials.json` в корень проекта.
3. **Откройте порт и настройте автозапуск:**
   ```bash
   bash setup_logger_api.sh
   ```
   После запуска скрипт выведет ссылку для доступа к API и UI.
4. **Откройте интерфейс:**
   Перейдите по ссылке, которую покажет скрипт, например:
   http://<ip_сервера>:7998/

## Отключить автозапуск
```bash
bash remove_logger_api_autostart.sh
```

## API
### POST `/log`
Пример тела запроса (JSON):
```json
{
  "filename": "example.mp3",
  "duration": 123.4,
  "size": 1048576,
  "received_at": "2025-07-21 12:34:56",
  "queue_time": 2.1,
  "process_time": 1.7,
  "text": "Распознанный текст"
}
```

### GET `/stats`
Возвращает статистику по времени поступления файлов (для графика).

### GET `/histogram`
Гистограмма по дням (для второго графика).

### GET `/logs?filename=&date=`
Список логов с фильтрами по имени и дате.

### GET `/log_text?filename=...&received_at=...`
Текст конкретного лога.

### GET `/summary`
Общее количество файлов и суммарное время.

## UI
- Тёмный современный дизайн
- Два графика (по минутам и по дням)
- Фильтры по имени и дате
- Таблица логов с просмотром содержимого
- Блок с количеством файлов и общим временем