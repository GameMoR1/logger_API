# LogerAPI

FastAPI-сервис для логирования информации о файлах и сохранения логов на Google Диск. Веб-интерфейс отображает статистику поступления файлов в реальном времени.

## Возможности
- Приём POST-запросов с данными о файле (без самого файла)
- Сохранение логов в Google Drive, разложенных по папкам по дате
- Быстрая загрузка логов через индекс-файл (logs_index.json) на Google Drive
- Каждый лог хранится с уникальным file_id (Google Drive id), что гарантирует корректное удаление и работу с дубликатами
- Веб-интерфейс с двумя графиками (по минутам и по дням), фильтрами, просмотром логов, удалением по кнопке
- Современный тёмный UI (HTML/CSS/JS, Chart.js)
- Автообновление: графики — раз в минуту, таблица и summary — раз в секунду, полная синхронизация с Google Drive — раз в 5 минут
- Автозапуск сервиса при перезагрузке сервера (systemd)
- Удобная настройка параметров через UI (редактирование файла другого репозитория)
- Откат настроек и автозаполнение адреса API через UI

## Структура проекта
```
LogerAPI/
├── app/
│   ├── api.py           # FastAPI endpoints
│   ├── constants.py     # Константы
│   ├── gdrive_logger.py # Работа с Google Drive и индекс-файлом
│   └── static/          # index.html, style.css, script.js, settings.html, settings.js
├── main.py              # Точка входа FastAPI
├── requirements.txt     # Зависимости
├── setup_logger_api.sh  # Скрипт для автозапуска и открытия порта
├── remove_logger_api_autostart.sh # Скрипт для удаления автозапуска
├── test_api_request.py  # Пример тестового запроса к API
```

## Быстрый старт (Ubuntu/Windows)
1. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```
2. **Создайте OAuth2-клиент Google API** и положите `client_secret.json` в корень проекта. При первом запуске потребуется пройти авторизацию в браузере.
3. **Откройте порт и настройте автозапуск (Linux):**
   ```bash
   bash setup_logger_api.sh
   ```
   После запуска скрипт выведет ссылку для доступа к API и UI.
4. **Откройте интерфейс:**
   Перейдите по ссылке, которую покажет скрипт, например:
   http://<ip_сервера>:7998/

## Отключить автозапуск
```bash
bash remove_logger_api_autostart.sh
```

## API
### POST `/log`
Пример тела запроса (JSON):
```json
{
  "filename": "example.mp3",
  "duration": 123.4,
  "size": 1048576,
  "received_at": "2025-07-21 12:34:56",
  "queue_time": 2.1,
  "process_time": 1.7,
  "text": "Распознанный текст"
}
```

### GET `/logs`
Возвращает список логов (метаданные, без текста).

### GET `/log_text?filename=...&received_at=...`
Возвращает полный текст лога.

### DELETE `/log?file_id=...`
Удаляет лог по file_id (Google Drive id).

## Настройка через UI
- На главной странице есть кнопка "Настроить сервис" — переход на страницу настройки параметров (модели, webhook, URL и др.).
- Можно откатить изменения или автоматически подставить адрес API.

## Безопасность
- Не храните `client_secret.json`, `token.pickle`, `logs_index.json` в репозитории (см. .gitignore).

## Пример тестового запроса
```bash
python test_api_request.py
```

---

**Вопросы и предложения:** пишите в Issues или Pull Requests!